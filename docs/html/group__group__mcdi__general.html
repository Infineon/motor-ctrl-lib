<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Infineon Motor Control Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Infineon Motor Control Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__group__mcdi__general.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle"><div class="title">Motor Control Driver Interface (MCDI)</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p >The MCDI represents the device-agnostic top-level API source code, the control service code, and the Solution Personality. </p>
<p >The Solution Personality:</p><ul>
<li>provides the integration with the Device Configurator</li>
<li>provides a graphical configuration interface</li>
<li>generates device-specific HW configuration code and the control code for the motor control applications</li>
<li>generates templates for the fast and slow control loop ISRs</li>
<li>supports Direct Memory Access (DMA) transfers for the ADC and Modulator data</li>
<li>supports single-shunt and three-shunt load current measurement schemes</li>
<li>supports up-to-two motor instances</li>
</ul>
<div class="image">
<img src="MCDI_structure.png" alt="" width="50%"/>
</div>
<h1><a class="anchor" id="section_mcdi_quick_start"></a>
Quick Start</h1>
<p >In order to use the MCDI as a standalone interface for alternative motor control libraries:</p>
<ul>
<li>Create a New Application in ModusToolbox&trade; IDE <dl class="section user"><dt></dt><dd><div class="image">
<img src="MakeNewApp.png" alt="" width="9%"/>
</div>
</dd></dl>
</li>
<li>Use the 'Empty App' template. <dl class="section user"><dt></dt><dd><div class="image">
<img src="UseTemplate.png" alt=""/>
</div>
</dd></dl>
</li>
<li>Add the 'motor-ctrl-lib' to the created application using the Library Manager <dl class="section user"><dt></dt><dd><div class="image">
<img src="UseLibraryManager.png" alt="" width="10%"/>
</div>
</dd></dl>
</li>
<li>Add this code into the project 'Makefile' <dl class="section user"><dt></dt><dd><div class="image">
<img src="MakefileContent.png" alt=""/>
</div>
</dd></dl>
</li>
<li>Launch the Device Configurator <dl class="section user"><dt></dt><dd><div class="image">
<img src="LaunchDeviceConfigurator.png" alt="" width="12%"/>
</div>
</dd></dl>
</li>
<li>Add the Motor Control instance <dl class="section user"><dt></dt><dd><div class="image">
<img src="myMotor.png" alt=""/>
</div>
</dd></dl>
</li>
<li>Configure all hardware-specific Motor Control solution parameters and save them (or press Ctrl+S to save). After that, the appropriate code for the application will be generated by the Solution Personality.</li>
<li>Add both the <a class="el" href="group__group__mcdi__general.html#myMotor_slow_callback">myMotor_slow_callback</a> function definition and the <a class="el" href="group__group__mcdi__general.html#myMotor_fast_callback">myMotor_fast_callback</a> function definition into the <b>main.c</b>.</li>
<li>Build the project.</li>
</ul>
<h1><a class="anchor" id="section_mcdi_usage_details"></a>
Usage Details</h1>
<p >Assume the motor instance is named in the ModusToolbox&trade; Device Configurator Tool as <b>myMotor</b>. </p>
<h2><a class="anchor" id="subsection_mcdi_functions"></a>
Application Programming Interface</h2>
<dl class="section user"><dt></dt><dd>The simplest way to use <b>myMotor</b> is to use the <a class="el" href="group__group__mcdi__gen__func.html">instance-based generated myMotor API</a>: <div class="fragment"><div class="line">    <span class="comment">/* Assume the HPPASS (as well as other shared resource) is already initialized */</span></div>
<div class="line">    <a class="code hl_function" href="group__group__mcdi__gen__func.html#ga9d6181da9931025b40f10f917e9c4f1a">myMotor_init</a>(); <span class="comment">/* Initialize all the motor-specific PWMs and Timers */</span></div>
<div class="line">    <span class="comment">/* Initialize all the rest of solutions/peripherals */</span></div>
<div class="line">    <a class="code hl_function" href="group__group__mcdi__gen__func.html#gad4061e0fed2c3686d324775f6880606c">myMotor_enable</a>(); <span class="comment">/* Enable all the motor-specific PWMs and Timers, after this action they are sensitive to input triggers */</span></div>
<div class="line">    <span class="comment">/* Enable all the rest of solutions/peripherals */</span></div>
<div class="line">    <a class="code hl_function" href="group__group__mcdi__gen__func.html#gafb3aed4c9a089c5994b20af54afae559">myMotor_start</a>(); <span class="comment">/* Safely start the shared resources (if not started yet) and all the motor-specific PWMs and Timers synchronously (except the Slow Timer - it is started asynchronously) */</span></div>
<div class="ttc" id="agroup__group__mcdi__gen__func_html_ga9d6181da9931025b40f10f917e9c4f1a"><div class="ttname"><a href="group__group__mcdi__gen__func.html#ga9d6181da9931025b40f10f917e9c4f1a">myMotor_init</a></div><div class="ttdeci">cy_rslt_t myMotor_init(void)</div><div class="ttdoc">Performs the Motor Control instance initialization sequence:</div></div>
<div class="ttc" id="agroup__group__mcdi__gen__func_html_gad4061e0fed2c3686d324775f6880606c"><div class="ttname"><a href="group__group__mcdi__gen__func.html#gad4061e0fed2c3686d324775f6880606c">myMotor_enable</a></div><div class="ttdeci">__STATIC_INLINE cy_rslt_t myMotor_enable(void)</div><div class="ttdoc">Performs the Motor Control instance enable sequence:</div></div>
<div class="ttc" id="agroup__group__mcdi__gen__func_html_gafb3aed4c9a089c5994b20af54afae559"><div class="ttname"><a href="group__group__mcdi__gen__func.html#gafb3aed4c9a089c5994b20af54afae559">myMotor_start</a></div><div class="ttdeci">cy_rslt_t myMotor_start(void)</div><div class="ttdoc">Performs the Motor Control instance start sequence:</div></div>
</div><!-- fragment --> <br  />
 </dd></dl>
<dl class="section note"><dt>Note</dt><dd>It is not recommended to use any MCDI FW items (definitions, enums, structures or functions) from static sources or generated files which are not described in this document.</dd></dl>
<h2><a class="anchor" id="subsection_mcdi_control"></a>
Cascade Control</h2>
<dl class="section user"><dt></dt><dd>The Solution Personality GUI and its code generation engine provide users a template to create a cascaded control system with the inner and outer control loops.<br  />
 The inner control loop name in MCDI is a Fast Control Loop, and the outer control loop name is a Slow Control Loop.<br  />
 <br  />
The Fast Control Loop settings provide:<ul>
<li>Automatic/manual allocation of hardware resources for Sync timer functionality</li>
<li>Automatic/manual allocation of hardware resources for Fast timer functionality</li>
<li>Configuration of the Fast Control Loop frequency to PWM frequency ratio</li>
<li>Configuration of the time point for updating the timer compare value</li>
<li>Configuration of the time point for starting ADC group conversions</li>
<li>Configuration of the Fast Control Loop interrupt priority</li>
<li>Definition of the Fast Control Loop callback function identifier </li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>The Slow Control Loop settings provide:<ul>
<li>Automatic/manual allocation of hardware resources for the Slow timer functionality</li>
<li>Slow Control Loop frequency to Fast Control Loop frequency ratio configuration</li>
<li>Slow Control Loop interrupt-priority configuration</li>
<li>Slow Control Loop callback-function name definition </li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>The Solution Personality code generation engine declares all user-predefined callbacks as external functions with such a prototype: <div class="fragment"><div class="line"><span class="keyword">extern</span> uint16_t predefined_function_name(<span class="keywordtype">void</span>) </div>
</div><!-- fragment --> Because of this, in the user application, the appropriate function definitions must be made at the global level.<br  />
 You can use as a template (in the main.c, for example), the functions from the code snippets listed below. <a class="anchor" id="myMotor_slow_callback"></a> <div class="fragment"><div class="line"><span class="keywordtype">void</span> myMotor_slow_callback(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    (void)myMotor_VBUS_get_result();</div>
<div class="line">    <span class="comment">/* Perform the slow control loop processing here */</span></div>
<div class="line">}</div>
</div><!-- fragment --> <a class="anchor" id="myMotor_fast_callback"></a> <div class="fragment"><div class="line"><span class="keywordtype">void</span> myMotor_fast_callback(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    (void)<a class="code hl_function" href="group__group__mcdi__gen__func.html#ga2f9a4a6e6dfd9c1643f63491b33ff994">myMotor_IUP_get_result</a>();</div>
<div class="line">    (void)myMotor_IVP_get_result();</div>
<div class="line">    (void)myMotor_IWP_get_result();</div>
<div class="line">    <span class="comment">/* Perform the fast control loop processing here */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__group__mcdi__gen__func_html_ga2f9a4a6e6dfd9c1643f63491b33ff994"><div class="ttname"><a href="group__group__mcdi__gen__func.html#ga2f9a4a6e6dfd9c1643f63491b33ff994">myMotor_IUP_get_result</a></div><div class="ttdeci">__STATIC_FORCEINLINE uint32_t myMotor_IUP_get_result(void)</div><div class="ttdoc">Gets the ADC channel result in raw counts.</div></div>
</div><!-- fragment --></dd></dl>
<h2><a class="anchor" id="subsection_mcdi_inter_connectivity"></a>
Resources interconnection and synchronization</h2>
<dl class="section user"><dt></dt><dd>The MCDI Solution Personality occupies the following resources for each Motor Control instance:<ul>
<li>Three timers in PWM mode</li>
<li>Three timers in Timer mode</li>
<li>Two ADC Sequencer groups, the number of the ADC channels in each is configuration-dependent</li>
<li>Seven or eight GPIOs (depends on configuration)</li>
<li>Two or three HW interrupts (depends on configuration) </li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>The Motor Control instance resource interconnection depends on the selected measurement scheme. The difference is highlighted in the picture below. <div class="image">
<img src="MCDI_resources_interconnection.png" alt="" width="60%"/>
</div>
 <br  />
 All the PWM, Sync, Fast timers start synchronously, and the Slow timer starts asynchronously.<br  />
 The instance-based <a class="el" href="group__group__mcdi__gen__func.html#gafb3aed4c9a089c5994b20af54afae559">myMotor_start</a> function is provided by MCDI for this purpose.<br  />
 The Fast timer generates one output pulse trigger on the compare event in the Three-shunt topology, and two output pulse triggers in the Single-shunt topology. The trigger points are configurable;<br  />
 the only difference is that because of additional swap trigger used in the Single-shunt topology, the trigger points can be changed by software on the fly.</dd></dl>
<h2><a class="anchor" id="subsection_mcdi_dma"></a>
Direct Memory Access</h2>
<p >The MCDI supports DMA transfers for the ADC and Modulator data, which enables MCU offloading and reduces the Fast ISR duration. These two features are independent and can be used simultaneously or separately. <a class="anchor" id="par_mcdi_dma_adc"></a></p><dl class="section user"><dt>ADC DMA</dt><dd>The ADC DMA functionality is enabled by checking the "Use DMA" checkbox in the "ADC" subgroup of the MCDI configurations. <div class="image">
<img src="ADC_DMA_enable.png" alt=""/>
</div>
 The ADC DMA transfers all conversion results of the ADC channels triggered by the Fast timer from Result registers to their respective memory locations. The ADC DMA channel is triggered automatically by the Group Done event.</dd></dl>
<p><a class="anchor" id="par_mcdi_dma_mod"></a></p><dl class="section user"><dt>Modulator DMA</dt><dd>The Modulator DMA functionality is enabled by checking the "Use DMA" checkbox in the "PWM" subgroup of the MCDI configurations. <div class="image">
<img src="Modulator_DMA_enable.png" alt=""/>
</div>
 The Modulator DMA transfers the modulator compare values from memory locations to their respective hardware Compare Buffer registers. The DMA transfer does not start automatically, to start it, the <a class="el" href="group__group__mcdi__gen__func.html#ga366b351e95e40f91191b8f0133b8d220">myMotor_mod_update</a> function shall be called. </dd></dl>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__mcdi__status"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__mcdi__status.html">Status</a></td></tr>
<tr class="memdesc:group__group__mcdi__status"><td class="mdescLeft">&#160;</td><td class="mdescRight">Statuses for the MCDI API functions. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__mcdi__topologies"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__mcdi__topologies.html">Topologies</a></td></tr>
<tr class="memdesc:group__group__mcdi__topologies"><td class="mdescLeft">&#160;</td><td class="mdescRight">Topologies of current measurement. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__mcdi__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__mcdi__data__structures.html">Data Structures</a></td></tr>
<tr class="memdesc:group__group__mcdi__data__structures"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interface data structures. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__mcdi__gen__func"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__mcdi__gen__func.html">Functions</a></td></tr>
<tr class="memdesc:group__group__mcdi__gen__func"><td class="mdescLeft">&#160;</td><td class="mdescRight">All of the MCDI functions are instance-based; function names start with the instance name and depend on user configuration. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>Infineon Motor Control Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
