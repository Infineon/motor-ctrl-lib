<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Infineon Motor Control Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Infineon Motor Control Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__group__mcdi__general.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle"><div class="title">Motor Control Driver Interface (MCDI)</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p >The MCDI represents the device-agnostic top-level API source code, the control service code, and the Solution Personality. </p>
<p >The Solution Personality:</p><ul>
<li>provides the integration with the Device Configurator</li>
<li>provides a graphical configuration interface</li>
<li>generates device-specific HW configuration code and the control code for the motor control applications</li>
<li>generates templates for the fast and slow control loop ISRs</li>
<li>supports single-shunt and three-shunt load current measurement schemes</li>
<li>supports up-to-two motor instances</li>
</ul>
<div class="image">
<img src="MCDI_structure.png" alt="" width="50%"/>
</div>
<h1><a class="anchor" id="section_mcdi_quick_start"></a>
Quick Start</h1>
<p >In order to use the MCDI as a standalone interface for alternative motor control libraries:</p>
<ul>
<li>Create a New Application in ModusToolbox&trade; IDE <dl class="section user"><dt></dt><dd><div class="image">
<img src="MakeNewApp.png" alt="" width="9%"/>
</div>
</dd></dl>
</li>
<li>Use the 'Empty App' template. <dl class="section user"><dt></dt><dd><div class="image">
<img src="UseTemplate.png" alt=""/>
</div>
</dd></dl>
</li>
<li>Add the 'motor-ctrl-lib' to the created application using the Library Manager <dl class="section user"><dt></dt><dd><div class="image">
<img src="UseLibraryManager.png" alt="" width="10%"/>
</div>
</dd></dl>
</li>
<li>Add this code into the project 'Makefile' <dl class="section user"><dt></dt><dd><div class="image">
<img src="MakefileContent.png" alt=""/>
</div>
</dd></dl>
</li>
<li>Launch the Device Configurator <dl class="section user"><dt></dt><dd><div class="image">
<img src="LaunchDeviceConfigurator.png" alt="" width="12%"/>
</div>
</dd></dl>
</li>
<li>Add the Motor Control instance <dl class="section user"><dt></dt><dd><div class="image">
<img src="myMotor.png" alt=""/>
</div>
</dd></dl>
</li>
<li>Configure all hardware-specific Motor Control solution parameters and save them (or press Ctrl+S to save). After that, the appropriate code for the application will be generated by the Solution Personality.</li>
<li>Add both the <a class="el" href="group__group__mcdi__general.html#myMotor_slow_callback">myMotor_slow_callback</a> function definition and the <a class="el" href="group__group__mcdi__general.html#myMotor_fast_callback">myMotor_fast_callback</a> function definition into the <b>main.c</b>.</li>
<li>Build the project.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The <b>Init</b> function will be created and its call at startup will be performed in scope of the <b>init_cycfg_all()</b> function only if the "Initialize During Startup" checkbox is checked during configuration process in the Device Configurator tool. <div class="image">
<img src="init.png" alt=""/>
</div>
</dd></dl>
<h1><a class="anchor" id="section_mcdi_usage_details"></a>
Usage Details</h1>
<p >Assume the motor instance is named in the ModusToolbox&trade; Device Configurator Tool as <b>myMotor</b>. </p>
<h2><a class="anchor" id="subsection_mcdi_functions"></a>
The MCDI Functions</h2>
<dl class="section user"><dt></dt><dd>The simplest way to use <b>myMotor</b> is to use the <a class="el" href="group__group__mcdi__gen__func.html">instance-based generated myMotor API</a>: <div class="fragment"><div class="line">    <span class="comment">/* Assume the HPPASS (as well as other shared resource) is already initialized */</span></div>
<div class="line">    <a class="code hl_function" href="group__group__mcdi__gen__func.html#gaef43d6aaf392bb7de1aae1200a9235aa">myMotor_init</a>(); <span class="comment">/* Initialize all the motor-specific PWMs and Timers */</span></div>
<div class="line">    <span class="comment">/* Initialize all the rest of solutions/peripherals */</span></div>
<div class="line">    <a class="code hl_function" href="group__group__mcdi__gen__func.html#ga4112d22a7c82ada7dc03f5370cb22f80">myMotor_enable</a>(); <span class="comment">/* Enable all the motor-specific PWMs and Timers, after this action they are sensitive to input triggers */</span></div>
<div class="line">    <span class="comment">/* Enable all the rest of solutions/peripherals */</span></div>
<div class="line">    <a class="code hl_function" href="group__group__mcdi__gen__func.html#ga9c36d7e592ae9e25af6da22ce444b0da">myMotor_start</a>(); <span class="comment">/* Safely start the shared resources (if not started yet) and all the motor-specific PWMs and Timers synchronously (except the Slow Timer - it is started asynchronously) */</span></div>
<div class="ttc" id="agroup__group__mcdi__gen__func_html_ga4112d22a7c82ada7dc03f5370cb22f80"><div class="ttname"><a href="group__group__mcdi__gen__func.html#ga4112d22a7c82ada7dc03f5370cb22f80">myMotor_enable</a></div><div class="ttdeci">__STATIC_INLINE void myMotor_enable(void)</div><div class="ttdoc">Enables the Motor Control instance.</div></div>
<div class="ttc" id="agroup__group__mcdi__gen__func_html_ga9c36d7e592ae9e25af6da22ce444b0da"><div class="ttname"><a href="group__group__mcdi__gen__func.html#ga9c36d7e592ae9e25af6da22ce444b0da">myMotor_start</a></div><div class="ttdeci">void myMotor_start(void)</div><div class="ttdoc">Starts the Motor Control instance.</div></div>
<div class="ttc" id="agroup__group__mcdi__gen__func_html_gaef43d6aaf392bb7de1aae1200a9235aa"><div class="ttname"><a href="group__group__mcdi__gen__func.html#gaef43d6aaf392bb7de1aae1200a9235aa">myMotor_init</a></div><div class="ttdeci">void myMotor_init(void)</div><div class="ttdoc">Initializes the Motor Control instance.</div></div>
</div><!-- fragment --> Or, as an alternative you can use the <a class="el" href="group__group__mcdi__functions.html">MCDI data-driven API functions</a>: <div class="fragment"><div class="line">    <span class="keywordflow">if</span> (CY_RSLT_SUCCESS != <a class="code hl_function" href="group__group__mcdi__functions.html#ga51a3bd9bed4fc1317476522d054fb583">mtb_mcdi_init</a>(&amp;myMotor_cfg))</div>
<div class="line">    {</div>
<div class="line">        CY_ASSERT(<span class="keyword">false</span>); <span class="comment">/* Process possible error here */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__group__mcdi__functions.html#gacbee2416e6dfff366a74a3cea179c2cc">mtb_mcdi_enable</a>(&amp;myMotor_cfg);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (CY_RSLT_SUCCESS != <a class="code hl_function" href="group__group__mcdi__functions.html#gace17318abfe875652b61ba0f43824339">mtb_mcdi_start</a>(&amp;myMotor_cfg))</div>
<div class="line">    {</div>
<div class="line">        CY_ASSERT(<span class="keyword">false</span>); <span class="comment">/* Process possible error here */</span></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* after some time, when motor control HW has to be stopped */</span></div>
<div class="line">    <a class="code hl_function" href="group__group__mcdi__functions.html#gad3dd6a067f1d7921b2ff843cdb62111e">mtb_mcdi_disable</a>(&amp;myMotor_cfg);</div>
<div class="ttc" id="agroup__group__mcdi__functions_html_ga51a3bd9bed4fc1317476522d054fb583"><div class="ttname"><a href="group__group__mcdi__functions.html#ga51a3bd9bed4fc1317476522d054fb583">mtb_mcdi_init</a></div><div class="ttdeci">cy_rslt_t mtb_mcdi_init(mtb_stc_mcdi_cfg_t const *cfg)</div><div class="ttdoc">Initializes all MCDI Timers and PWMs.</div><div class="ttdef"><b>Definition:</b> mtb_mcdi.c:46</div></div>
<div class="ttc" id="agroup__group__mcdi__functions_html_gacbee2416e6dfff366a74a3cea179c2cc"><div class="ttname"><a href="group__group__mcdi__functions.html#gacbee2416e6dfff366a74a3cea179c2cc">mtb_mcdi_enable</a></div><div class="ttdeci">cy_rslt_t mtb_mcdi_enable(mtb_stc_mcdi_cfg_t const *cfg)</div><div class="ttdoc">Enables all MCDI Timers and PWMs.</div><div class="ttdef"><b>Definition:</b> mtb_mcdi.c:73</div></div>
<div class="ttc" id="agroup__group__mcdi__functions_html_gace17318abfe875652b61ba0f43824339"><div class="ttname"><a href="group__group__mcdi__functions.html#gace17318abfe875652b61ba0f43824339">mtb_mcdi_start</a></div><div class="ttdeci">cy_rslt_t mtb_mcdi_start(mtb_stc_mcdi_cfg_t const *cfg)</div><div class="ttdoc">Starts all the PWMs and Sync and Fast Timers synchronously.</div><div class="ttdef"><b>Definition:</b> mtb_mcdi.c:141</div></div>
<div class="ttc" id="agroup__group__mcdi__functions_html_gad3dd6a067f1d7921b2ff843cdb62111e"><div class="ttname"><a href="group__group__mcdi__functions.html#gad3dd6a067f1d7921b2ff843cdb62111e">mtb_mcdi_disable</a></div><div class="ttdeci">cy_rslt_t mtb_mcdi_disable(mtb_stc_mcdi_cfg_t const *cfg)</div><div class="ttdoc">Stops and Disables all MCDI Timers and PWMs.</div><div class="ttdef"><b>Definition:</b> mtb_mcdi.c:108</div></div>
</div><!-- fragment --> The first is preferable.</dd></dl>
<h2><a class="anchor" id="subsection_mcdi_control"></a>
The MCDI Cascade Control</h2>
<dl class="section user"><dt></dt><dd>The Solution Personality GUI and its code generation engine provide users a template to create a cascaded control system with the inner and outer control loops.<br  />
 The inner control loop name in MCDI is a Fast Control Loop, and the outer control loop name is a Slow Control Loop.<br  />
 <br  />
The Fast Control Loop settings provide:<ul>
<li>automatic/manual allocation of hardware resources for the Sync timer functionality</li>
<li>automatic/manual allocation of hardware resources for the Fast timer functionality</li>
<li>Fast Control Loop frequency to PWM frequency ratio configuration</li>
<li>Timer compare-value update time-point configuration</li>
<li>ADC group conversion-start time-point configuration</li>
<li>Fast Control Loop interrupt priority configuration</li>
<li>Fast Control Loop callback-function name definition</li>
<li>ADC conversion-result storage-array name definition </li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>The Slow Control Loop settings provide:<ul>
<li>automatic/manual allocation of hardware resources for the Slow timer functionality</li>
<li>Slow Control Loop frequency to Fast Control Loop frequency ratio configuration</li>
<li>Slow Control Loop interrupt-priority configuration</li>
<li>Slow Control Loop callback-function name definition </li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>The Solution Personality code generation engine declares all user-predefined callbacks as external functions with such a prototype: <div class="fragment"><div class="line"><span class="keyword">extern</span> uint16_t predefined_function_name(<span class="keywordtype">void</span>) </div>
</div><!-- fragment --> Because of this, in the user application, the appropriate function definitions must be made at the global level.<br  />
 You can use as a template (in the main.c, for example), the functions from the code snippets listed below. <a class="anchor" id="myMotor_slow_callback"></a> <div class="fragment"><div class="line"><span class="preprocessor">#define MY_MOTOR_SUCCESS (0U)</span></div>
<div class="line"> </div>
<div class="line">uint16_t myMotor_slow_callback(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint16_t state = MY_MOTOR_SUCCESS;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> state;</div>
<div class="line">}</div>
</div><!-- fragment --> <a class="anchor" id="myMotor_fast_callback"></a> <div class="fragment"><div class="line">uint16_t myMotor_fast_callback(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    (void)myMotor_fastDataPtr[0]; <span class="comment">/*Iu*/</span></div>
<div class="line">    (void)myMotor_fastDataPtr[1]; <span class="comment">/*Iv*/</span></div>
<div class="line">    (void)myMotor_fastDataPtr[2]; <span class="comment">/*Iw*/</span></div>
<div class="line"> </div>
<div class="line">    uint16_t state = MY_MOTOR_SUCCESS;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> state;</div>
<div class="line">}</div>
</div><!-- fragment --></dd></dl>
<h2><a class="anchor" id="subsection_mcdi_inter_connectivity"></a>
The MCDI resources interconnection and synchronization</h2>
<dl class="section user"><dt></dt><dd>The MCDI Solution Personality occupies the following resources for each Motor Control instance:<ul>
<li>Three timers in PWM mode</li>
<li>Three timers in Timer mode</li>
<li>Two HPPASS SAR Sequencer groups, with three ADC channels in each</li>
<li>Seven or eight GPIOs (depends on configuration)</li>
<li>Two or three HW interrupts (depends on configuration) </li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>The Motor Control instance interconnection is shown in the picture below. <div class="image">
<img src="MCDI_resources_interconnection.png" alt=""/>
</div>
 <br  />
 All the PWM, Sync and Fast timers are synchronized by the Personality engine and started synchronously. The Slow Timer is not synchronized with the others and starts asynchronously.<br  />
 The instance-based <a class="el" href="group__group__mcdi__gen__func.html#ga9c36d7e592ae9e25af6da22ce444b0da">myMotor_start</a> and the data-driven <a class="el" href="group__group__mcdi__functions.html#gace17318abfe875652b61ba0f43824339">mtb_mcdi_start</a> functions are provided by MCDI for this purpose. </dd></dl>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__mcdi__macros"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__mcdi__macros.html">Macros</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__mcdi__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__mcdi__enums.html">Enumerated Types</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__mcdi__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__mcdi__data__structures.html">Data Structures</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__mcdi__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__mcdi__functions.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__mcdi__gen__func"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__mcdi__gen__func.html">Generated Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>Infineon Motor Control Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
